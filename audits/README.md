# Gemini - Claude Code Auditor

## Role and Purpose

As Gemini, my primary role in this directory is to act as a **security and code quality auditor** for the code generated by the Claude agent. The goal is to provide a "second opinion" on the code, ensuring it is secure, robust, and follows best practices.

This collaborative process helps to:
-   **Identify and mitigate security vulnerabilities** before they are deployed.
-   **Improve code quality** by catching potential bugs and suggesting improvements.
-   **Foster a culture of security and quality** by having a dedicated audit process.
-   **Learn from each other's strengths and weaknesses**, as highlighted in the audit responses.

## Audit Process

1.  **Audit Request:** I will be prompted to perform an audit of the codebase.
2.  **Code Review:** I will analyze the code, looking for security vulnerabilities, performance issues, and deviations from best practices.
3.  **Audit Report:** I will create a new audit report in this directory, with a filename like `YYYYMMDD_GEMINI_AUDIT.md`. This report will detail my findings, including severity levels, locations, and recommendations for remediation.
4.  **Claude's Response:** The Claude agent (or the user) will review my audit and create a response file, named `YYYYMMDD_CLAUDE_RESPONSE.md`. This response should address each of my findings, indicating whether they are fixed, a design decision, a false positive, or backlogged.
5.  **Review and Learn:** I will review Claude's response to understand the actions taken and to improve my future audits.

## Expected Response Format

When responding to an audit, please follow the format in `20251111_CLAUDE_RESPONSE.md`. This includes:

-   An **Executive Summary** with the status of the audit.
-   An **Issues Summary** table that tracks the status of each finding.
-   A **Detailed Response** for each issue, including:
    -   The finding and its impact.
    -   The status (e.g., FIXED, DESIGN DECISION, FALSE POSITIVE, BACKLOG).
    -   The fix applied (with code snippets).
    -   The reasoning behind the decision.
-   An **Audit Quality Assessment** section with feedback on my audit. This is valuable for my learning process.

By following this process, we can work together to create a more secure and reliable application.

---

## Automation

### Available Automation Scripts

The following scripts are available in `../scripts/` for automating security audits:

#### 1. Manual Audit
```bash
cd /home/sysadmin/nextjs/fossapp
./scripts/run-gemini-audit.sh
```

**Features**:
- Interactive mode (prompts for approval)
- Comprehensive security scan
- Formatted markdown output
- Quick summary of findings
- Alert for critical/high severity issues

**Auto-approve mode**:
```bash
./scripts/run-gemini-audit.sh --auto-approve
```

#### 2. Pre-Deployment Audit
```bash
./scripts/pre-deploy-audit.sh
```

**Features**:
- Runs deployment checks first
- Automated security audit
- **Blocks deployment** if critical/high issues found
- Returns exit code 1 for CI/CD integration

**Use case**: Add to deployment pipeline to prevent deploying vulnerable code.

#### 3. Scheduled Audits
```bash
# Weekly audits (recommended)
./scripts/schedule-audit.sh weekly

# Daily audits (high-security projects)
./scripts/schedule-audit.sh daily

# Monthly audits (stable projects)
./scripts/schedule-audit.sh monthly
```

**Note**: In WSL, cron may not be available. Use Windows Task Scheduler instead:
1. Open Task Scheduler
2. Create Basic Task
3. Action: `wsl.exe bash /home/sysadmin/nextjs/fossapp/scripts/run-gemini-audit.sh --auto-approve`

### Automation Use Cases

#### Use Case 1: Pre-Release Security Check
```bash
# Before creating a new version
npm run build && \
./scripts/pre-deploy-audit.sh && \
npm version patch && \
git push --tags
```

#### Use Case 2: CI/CD Integration
```yaml
# .github/workflows/security-audit.yml
name: Security Audit

on:
  pull_request:
  push:
    branches: [main]

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Gemini Security Audit
        run: ./scripts/pre-deploy-audit.sh
```

#### Use Case 3: Weekly Security Review
```bash
# Windows Task Scheduler (every Monday 2 AM)
wsl.exe bash /home/sysadmin/nextjs/fossapp/scripts/run-gemini-audit.sh --auto-approve
```

### Audit Output

**Generated files**:
- `YYYYMMDD_HHMMSS_GEMINI_AUDIT.md` - Audit report
- `audit.log` - Execution log (when scheduled)

**Expected format**:
```markdown
# Gemini Security Audit - YYYY-MM-DD

## Summary of Findings
| Severity | Finding | Location |

## Detailed Findings
### 1. [Severity]: [Title]
...
```

### Response Workflow

After receiving an audit report:

1. **Review the report**: `cat audits/YYYYMMDD_HHMMSS_GEMINI_AUDIT.md`
2. **Create response**: `audits/YYYYMMDD_HHMMSS_CLAUDE_RESPONSE.md`
3. **Address findings**: Fix, document, or defer issues
4. **Update status**: Use the Issues Summary table format

### Alert Thresholds

The automation scripts use these severity levels:

| Severity | Action |
|----------|--------|
| ðŸ”´ Critical | Block deployment, immediate fix required |
| ðŸŸ  High | Block deployment, fix before release |
| ðŸŸ¡ Medium | Review required, can deploy with justification |
| ðŸŸ¢ Low | Document and backlog |

### Best Practices

1. **Run audits before major releases**
   ```bash
   ./scripts/pre-deploy-audit.sh
   ```

2. **Schedule regular audits** (weekly recommended)
   ```bash
   ./scripts/schedule-audit.sh weekly
   ```

3. **Review audit logs periodically**
   ```bash
   tail -f audits/audit.log
   ```

4. **Keep audit history** (do not delete old audits)
   - Useful for tracking security improvements
   - Reference for future similar issues
   - Evidence of security due diligence

5. **Document all responses** (even for false positives)
   - Helps improve future audits
   - Provides context for design decisions
   - Creates institutional knowledge

### Troubleshooting

**Issue**: Gemini CLI not found
```bash
# Check if Gemini is installed
gemini --version

# If not installed, follow Gemini installation docs
```

**Issue**: Audit script fails with permission error
```bash
# Make scripts executable
chmod +x scripts/*.sh
```

**Issue**: Cron not working in WSL
- WSL doesn't always support cron
- Use Windows Task Scheduler instead (see Scheduled Audits section)

**Issue**: Audit takes too long
- Normal: 2-5 minutes for full codebase audit
- Use `--include-directories` to limit scope for faster audits

**Issue**: Too many false positives
- Review `audits/YYYYMMDD_CLAUDE_RESPONSE.md` for patterns
- Consider customizing the audit prompt in `run-gemini-audit.sh`
- Document common false positives in this README
